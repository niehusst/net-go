<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/static/css/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jaro:opsz@6..72&display=swap" rel="stylesheet">
  </head>

  <body>
    <script src="/static/js/elm.js"></script>
    <script>
      // load Web Worker
      const worker = new Worker("/static/js/worker.js");

      const authCookieSet = document.cookie
                                  .split("; ")
                                  .find((row) => row.startsWith("ngo_auth_set="))
                                  ?.split("=")[1];
      const app = Elm.Main.init({ flags: authCookieSet !== undefined });

      // listen for calls to `sendScoreGame` and pass along to web worker
      app.ports.listenForSendScoreGame.subscribe(function (game) {
        console.log(`sending ${game}`)
        worker.postMessage({ type: "score", value: game });
      });

      // listen for `returnScoreGame` responses from web worker
      worker.onmessage = funciton ({ data }) {
        console.log(`got returned game ${data}`)
        app.ports.returnScoreGame.send(data);
      }
    </script>
    <noscript>This App requires JavaScript.</noscript>
  </body>
</html>
